# 📊 PostHog Dashboards - AXSOL Viewer (CORREGIDO)

**Guía corregida basada en eventos ✅ IMPLEMENTADOS únicamente**

**Eventos base:** Solo eventos activos del `0.ANALYTICS_EVENTS_CATALOG.md`

---

## ✅ **Eventos Implementados Disponibles**

**Para Dashboards podemos usar:**
- ✅ `user_signed_up` - Registros
- ✅ `user_logged_in` - Inicios de sesión
- ✅ `viewer_loaded` - Carga del visor 3D
- ✅ `viewer_load_failed` - Errores de carga
- ✅ `entity_clicked` - Clicks en entidades 3D
- ✅ `camera_moved` - Navegación (con coordenadas)
- ✅ `camera_zoomed` - Zoom específico
- ✅ `camera_session_ended` - Fin de sesión navegación
- ✅ `home_view_activated` - Click botón Home
- ✅ `timeline_playback_control` - Control timeline
- ✅ `timeline_play_session` - Sesiones de reproducción
- ✅ `timeline_speed_changed` - Cambios de velocidad
- ✅ `timeline_date_jumped` - Saltos de fecha
- ✅ `timeline_loop_toggled` - Toggle bucle
- ✅ `layer_toggled` - Activación de capas
- ✅ `capture_date_changed` - Cambio fecha captura
- ✅ `media_lightbox_opened` - Apertura lightbox

---

## 🎯 Dashboards Implementables

### **1. Viewer Performance Dashboard** ✅
### **2. User Navigation Dashboard** ✅
### **3. Feature Adoption Dashboard** ✅
### **4. User Engagement Dashboard** ✅

---

## 📋 Dashboard 1: Viewer Performance ✅

**Objetivo:** Monitorear performance del visor con eventos reales.

### **A. Viewer Load Success Rate**

**Métrica:** Tasa de éxito de carga del viewer

**Cómo crear:**
1. PostHog → Dashboards → New Dashboard: "Viewer Performance"
2. Add Insight → Trends
3. Configurar:
   - Series A: `viewer_loaded` (count) ✅
   - Series B: `viewer_load_failed` (count) ✅
   - Formula: `A / (A + B) * 100`
   - Graph type: Line chart
   - Date range: Last 30 days

**Alertas:**
- ⚠️ Success rate < 95%
- 🚨 Success rate < 90%

---

### **B. Daily Viewer Loads**

**Métrica:** Volumen de cargas del viewer por día

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Event: `viewer_loaded` ✅
   - Aggregation: Total count
   - Breakdown: `project_id`
   - Graph type: Bar chart
   - Date range: Last 7 days

**Insights:**
- Proyectos más utilizados
- Patrones de uso por día

---

### **C. Error Tracking**

**Métrica:** Errores de carga del viewer

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Event: `viewer_load_failed` ✅
   - Aggregation: Total count
   - Breakdown: `error` (si disponible)
   - Graph type: Table
   - Date range: Last 7 days

**Alertas:**
- 🚨 Más de 5 errores por hora

---

## 📋 Dashboard 2: User Navigation ✅

**Objetivo:** Entender patrones de navegación reales.

### **A. Camera Movement Heatmap Data**

**Métrica:** Coordenadas más visitadas

**Cómo crear:**
1. Add Insight → Custom SQL
2. Query:
```sql
SELECT 
  ROUND(CAST(properties->>'latitude' AS NUMERIC), 3) as lat,
  ROUND(CAST(properties->>'longitude' AS NUMERIC), 3) as lon,
  COUNT(*) as visits,
  properties->>'project_id' as project_id
FROM events
WHERE event = 'camera_moved'
  AND timestamp > NOW() - INTERVAL '7 days'
  AND properties->>'latitude' IS NOT NULL
GROUP BY lat, lon, project_id
HAVING COUNT(*) > 3
ORDER BY visits DESC
LIMIT 200
```

**Exportación para heatmap:**
- Exportar CSV para usar en Kepler.gl o Mapbox
- Formato: latitude, longitude, weight, project_id

---

### **B. Navigation Session Duration**

**Métrica:** Duración de sesiones de navegación

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Event: `camera_session_ended` ✅
   - Property: `session_duration_s`
   - Aggregation: Average
   - Breakdown: `project_id`
   - Graph type: Bar chart
   - Date range: Last 30 days

**Insights:**
- Proyectos más "adictivos"
- Engagement por proyecto

---

### **C. Movement Type Distribution**

**Métrica:** Tipos de movimientos de cámara

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Event: `camera_moved` ✅
   - Aggregation: Total count
   - Breakdown: `movement_type` (zoom, pan, rotate, tilt, adjust)
   - Visualization: Pie chart
   - Date range: Last 7 days

**Insights esperados:**
- Zoom: ~40%
- Pan: ~30%
- Rotate: ~20%
- Tilt: ~10%

---

### **D. Home Button Usage**

**Métrica:** Frecuencia de uso del botón Home

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Event: `home_view_activated` ✅
   - Aggregation: Total count
   - Breakdown: `trigger` (button, shortcut)
   - Date range: Last 30 days

**Insights:**
- ¿Los usuarios se pierden navegando?
- Efectividad del botón Home

---

## 📋 Dashboard 3: Feature Adoption ✅

**Objetivo:** Medir adopción de features implementadas.

### **A. Timeline Adoption Funnel**

**Métrica:** Funnel de adopción del timeline

**Cómo crear:**
1. Add Insight → Funnel
2. Steps:
   - Step 1: `viewer_loaded` ✅
   - Step 2: `timeline_playback_control` ✅
   - Step 3: `timeline_play_session` ✅
   - Step 4: `timeline_speed_changed` ✅

**Insights:**
- % usuarios que descubren timeline
- % que realmente lo usan
- % que ajustan velocidad (power users)

---

### **B. Layer Usage Metrics**

**Métrica:** Adopción de capas

**Dashboard cards:**

#### **1. Layer Activation Rate**
```
Event: layer_toggled ✅
Series A: Unique users who toggled layers
Series B: Unique users who loaded viewer
Formula: (A / B) * 100
Display: "X% activated layers"
```

#### **2. Layer Type Distribution**
```
Event: layer_toggled ✅
Breakdown: layer_type (realidad3D, fotos, fotos360, plan, ifc)
Visualization: Bar chart
Filter: enabled = true
```

#### **3. Date Change Frequency**
```
Event: capture_date_changed ✅
Aggregation: Total count
Breakdown: layer_type
Date range: Last 30 days
```

---

### **C. Media Engagement**

**Métrica:** Uso del lightbox de fotos

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Event: `media_lightbox_opened` ✅
   - Aggregation: Total count
   - Breakdown: `media_type` (photo, photo360)
   - Date range: Last 30 days

**Insights:**
- Engagement con contenido visual
- Preferencia por fotos vs 360°

---

### **D. Entity Interaction Rate**

**Métrica:** Interacción con elementos 3D

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Event: `entity_clicked` ✅
   - Aggregation: Total count
   - Breakdown: `entity_type` (photo, photo360, plan, ifc)
   - Date range: Last 30 days

**Insights:**
- Elementos más clickeados
- Engagement con modelo 3D

---

## 📋 Dashboard 4: User Engagement ✅

**Objetivo:** Medir engagement general con eventos reales.

### **A. Daily Active Users (DAU)**

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Event: `user_logged_in` ✅
   - Aggregation: Unique users
   - Date range: Last 30 days
   - Graph type: Line chart

**Variantes:**
- WAU (Weekly Active Users)
- MAU (Monthly Active Users)

---

### **B. Viewer Engagement Rate**

**Métrica:** % de usuarios que usan el viewer después de login

**Cómo crear:**
1. Add Insight → Trends
2. Configurar:
   - Series A: `viewer_loaded` → Unique users ✅
   - Series B: `user_logged_in` → Unique users ✅
   - Formula: `(A / B) * 100`
   - Date range: Last 30 days

**Target:** >80% de usuarios que hacen login abren el viewer

---

### **C. Feature Usage Matrix (Implementado)**

**Métrica:** % de usuarios que usan cada feature disponible

#### **1. Timeline Usage Rate**
```
Series A: timeline_playback_control → Unique users ✅
Series B: viewer_loaded → Unique users ✅
Formula: (A / B) * 100
Display: "X% used Timeline"
```

#### **2. Layer Usage Rate**
```
Series A: layer_toggled → Unique users ✅
Series B: viewer_loaded → Unique users ✅
Formula: (A / B) * 100
Display: "X% toggled Layers"
```

#### **3. Navigation Rate**
```
Series A: camera_moved → Unique users ✅
Series B: viewer_loaded → Unique users ✅
Formula: (A / B) * 100
Display: "X% navigated actively"
```

#### **4. Media Viewing Rate**
```
Series A: media_lightbox_opened → Unique users ✅
Series B: viewer_loaded → Unique users ✅
Formula: (A / B) * 100
Display: "X% viewed media"
```

---

### **D. Session Quality Metrics**

**Métrica:** Calidad de las sesiones de usuario

#### **1. Average Navigation Session Duration**
```
Event: camera_session_ended ✅
Property: session_duration_s
Aggregation: Average
Breakdown: project_id
```

#### **2. Actions Per Viewer Session**
```sql
SELECT 
  DATE(timestamp) as date,
  COUNT(*) / COUNT(DISTINCT session_id) as avg_actions_per_session
FROM events
WHERE event IN ('camera_moved', 'entity_clicked', 'layer_toggled', 'timeline_playback_control')
  AND timestamp > NOW() - INTERVAL '30 days'
GROUP BY date
ORDER BY date
```

---

## 🎨 Dashboard Layout Implementable

### **Main Dashboard: Executive View**

```
┌─────────────────────────────────────────────────────┐
│  AXSOL Viewer - Overview Dashboard                  │
├──────────────┬──────────────┬──────────────────────┤
│ DAU          │ Viewer       │ Success Rate         │
│ (logged in)  │ Engagement   │ (load success)       │
│ 1,234        │ 85%          │ 97.2%                │
├──────────────┴──────────────┴──────────────────────┤
│                                                      │
│  Daily Active Users (Last 30 days)                  │
│  [Line chart: user_logged_in unique users]         │
│                                                      │
├──────────────────────────────────────────────────────┤
│  Feature Adoption (Implemented)                    │
│  ┌─────────────────────────────────────┐            │
│  │ Timeline:  45% │████████░░░░░░░░│   │            │
│  │ Layers:    78% │███████████████░│   │            │
│  │ Navigation:92% │████████████████│   │            │
│  │ Media:     34% │██████░░░░░░░░░░│   │            │
│  └─────────────────────────────────────┘            │
├──────────────────────────────────────────────────────┤
│  Top Projects by Engagement                         │
│  [Table: Project | Viewer Loads | Avg Nav Duration] │
└──────────────────────────────────────────────────────┘
```

---

## 🔔 Alertas Implementables

### **Performance Alerts**

```yaml
Alert 1: Viewer Load Failures
  Condition: viewer_load_failed count > 5 in last hour
  Severity: High
  Notify: Slack #tech-alerts

Alert 2: Low Viewer Engagement
  Condition: viewer_loaded unique users < 80% of user_logged_in
  Severity: Medium
  Notify: Email to product team

Alert 3: No Data
  Condition: No viewer_loaded events in last 2 hours
  Severity: High
  Notify: Slack + PagerDuty
```

### **Business Alerts**

```yaml
Alert 4: Low DAU
  Condition: user_logged_in unique users drops > 20% day-over-day
  Severity: Medium
  Notify: Slack #product

Alert 5: Feature Adoption Drop
  Condition: timeline_playback_control usage drops > 30% week-over-week
  Severity: Low
  Notify: Email to product team
```

---

## 🎯 KPIs Implementables

| KPI | Event Base | Target | Status |
|-----|------------|--------|--------|
| DAU | `user_logged_in` unique | 500 | 🟡 |
| Viewer Engagement | `viewer_loaded` / `user_logged_in` | >80% | 🟡 |
| Load Success Rate | `viewer_loaded` / (`viewer_loaded` + `viewer_load_failed`) | >95% | 🟡 |
| Timeline Adoption | `timeline_playback_control` / `viewer_loaded` | >40% | 🟡 |
| Layer Adoption | `layer_toggled` / `viewer_loaded` | >60% | 🟡 |
| Avg Navigation Session | `camera_session_ended.session_duration_s` avg | >5 min | 🟡 |

---

## 🚨 **Eventos NO Disponibles para Dashboards**

❌ **NO usar estos eventos** (pendientes):
- `photo360_viewer` → Usar `media_lightbox_opened` con `media_type: 'photo360'`
- `model_inspected` → No existe
- `viewer_error` → Usar `viewer_load_failed`
- `measurement_created` → Pendiente
- `dashboard_viewed` → Pendiente
- `project_clicked` → Pendiente

---

## 🚀 Próximos Pasos IMPLEMENTABLES

1. ✅ **Crear Dashboard 1: Viewer Performance** (30 min)
2. ✅ **Crear Dashboard 2: User Navigation** (45 min)
3. ✅ **Crear Dashboard 3: Feature Adoption** (45 min)
4. ✅ **Crear Dashboard 4: User Engagement** (30 min)
5. ✅ **Configurar alertas críticas** (15 min)
6. ✅ **Setup weekly reports** (10 min)

**Total tiempo estimado:** ~3 horas

---

## 📚 Queries SQL Útiles

### **Query 1: Navigation Heatmap Data**
```sql
SELECT 
  properties->>'project_id' as project,
  ROUND(CAST(properties->>'latitude' AS NUMERIC), 3) as lat,
  ROUND(CAST(properties->>'longitude' AS NUMERIC), 3) as lon,
  COUNT(*) as visits
FROM events
WHERE event = 'camera_moved'
  AND timestamp > NOW() - INTERVAL '7 days'
GROUP BY project, lat, lon
HAVING COUNT(*) > 2
ORDER BY visits DESC
```

### **Query 2: Feature Adoption Summary**
```sql
SELECT 
  'Timeline' as feature,
  COUNT(DISTINCT person_id) as users
FROM events
WHERE event = 'timeline_playback_control'
  AND timestamp > NOW() - INTERVAL '30 days'

UNION ALL

SELECT 
  'Layers' as feature,
  COUNT(DISTINCT person_id) as users
FROM events
WHERE event = 'layer_toggled'
  AND timestamp > NOW() - INTERVAL '30 days'

UNION ALL

SELECT 
  'Navigation' as feature,
  COUNT(DISTINCT person_id) as users
FROM events
WHERE event = 'camera_moved'
  AND timestamp > NOW() - INTERVAL '30 days'
```

### **Query 3: Daily Engagement Metrics**
```sql
SELECT 
  DATE(timestamp) as date,
  COUNT(DISTINCT CASE WHEN event = 'user_logged_in' THEN person_id END) as dau,
  COUNT(DISTINCT CASE WHEN event = 'viewer_loaded' THEN person_id END) as viewer_users,
  COUNT(DISTINCT CASE WHEN event = 'timeline_playback_control' THEN person_id END) as timeline_users
FROM events
WHERE timestamp > NOW() - INTERVAL '30 days'
GROUP BY date
ORDER BY date
```

---

**📊 Estado:** ✅ **IMPLEMENTABLE** - Solo eventos activos y funcionales
